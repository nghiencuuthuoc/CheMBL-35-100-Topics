# PharmApp Suite
## ðŸ§  AI for Drug Discovery and Development ðŸ§ª
| Copyright 2025 | NghiÃªn Cá»©u Thuá»‘c | www.nghiencuuthuoc.com | Zalo: +84888999311 |

ðŸ§© Topic: TÃ¬m target cÃ³ hoáº¡t tÃ­nh Ä‘á»‘i khÃ¡ng vÃ  Ä‘á»“ng váº­n
---
Tuyá»‡t vá»i! TÃ´i ráº¥t vui Ä‘Æ°á»£c há»— trá»£ báº¡n trong dá»± Ã¡n phÃ¢n tÃ­ch dá»¯ liá»‡u ChEMBL 35 nÃ y. Dá»±a trÃªn thÃ´ng tin báº¡n cung cáº¥p, chÃºng ta sáº½ táº­p trung vÃ o chá»§ Ä‘á» "Topic_CheMBL_35_39" vÃ  giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» cá»¥ thá»ƒ báº¡n gáº·p pháº£i.

**1. PhÃ¢n tÃ­ch mÃ´ hÃ¬nh phÃ¢n tÃ­ch (Analysis Model):**

Má»¥c tiÃªu cá»§a chá»§ Ä‘á» "Topic_CheMBL_35_39" lÃ  gÃ¬? Äá»ƒ Ä‘Æ°a ra mÃ´ hÃ¬nh phÃ¢n tÃ­ch phÃ¹ há»£p, chÃºng ta cáº§n xÃ¡c Ä‘á»‹nh rÃµ cÃ¢u há»i nghiÃªn cá»©u. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ kháº£ nÄƒng:

*   **Dá»± Ä‘oÃ¡n hoáº¡t tÃ­nh (Activity Prediction):** XÃ¢y dá»±ng mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n hoáº¡t tÃ­nh cá»§a cÃ¡c há»£p cháº¥t dá»±a trÃªn cáº¥u trÃºc hÃ³a há»c cá»§a chÃºng (vÃ­ dá»¥: dá»± Ä‘oÃ¡n IC50, Ki, EC50).
*   **PhÃ¢n tÃ­ch SAR (Structure-Activity Relationship):** TÃ¬m hiá»ƒu má»‘i quan há»‡ giá»¯a cáº¥u trÃºc hÃ³a há»c cá»§a cÃ¡c há»£p cháº¥t vÃ  hoáº¡t tÃ­nh sinh há»c cá»§a chÃºng. XÃ¡c Ä‘á»‹nh cÃ¡c nhÃ³m chá»©c (functional groups) hoáº·c pháº§n tá»­ cáº¥u trÃºc (structural motifs) quan trá»ng áº£nh hÆ°á»Ÿng Ä‘áº¿n hoáº¡t tÃ­nh.
*   **PhÃ¢n cá»¥m há»£p cháº¥t (Compound Clustering):** PhÃ¢n nhÃ³m cÃ¡c há»£p cháº¥t thÃ nh cÃ¡c cá»¥m dá»±a trÃªn tÃ­nh tÆ°Æ¡ng Ä‘á»“ng vá» cáº¥u trÃºc hoáº·c hoáº¡t tÃ­nh.
*   **PhÃ¢n tÃ­ch QSAR/QSPR (Quantitative Structure-Activity/Property Relationship):** XÃ¢y dá»±ng mÃ´ hÃ¬nh Ä‘á»‹nh lÆ°á»£ng má»‘i quan há»‡ giá»¯a cáº¥u trÃºc hÃ³a há»c vÃ  hoáº¡t tÃ­nh/tÃ­nh cháº¥t cá»§a há»£p cháº¥t.

Dá»±a trÃªn má»¥c tiÃªu cá»¥ thá»ƒ, chÃºng ta cÃ³ thá»ƒ lá»±a chá»n cÃ¡c phÆ°Æ¡ng phÃ¡p phÃ¢n tÃ­ch phÃ¹ há»£p:

*   **Machine Learning:** CÃ¡c thuáº­t toÃ¡n nhÆ° Random Forest, Support Vector Machines (SVM), Neural Networks, Gradient Boosting.
*   **Cheminformatics:** Sá»­ dá»¥ng cÃ¡c descriptor phÃ¢n tá»­ (vÃ­ dá»¥: Morgan fingerprints, physicochemical properties) Ä‘á»ƒ biá»ƒu diá»…n cáº¥u trÃºc hÃ³a há»c vÃ  phÃ¢n tÃ­ch.
*   **Statistical Analysis:** CÃ¡c phÆ°Æ¡ng phÃ¡p thá»‘ng kÃª nhÆ° há»“i quy tuyáº¿n tÃ­nh, phÃ¢n tÃ­ch phÆ°Æ¡ng sai (ANOVA).

**2. HÆ°á»›ng dáº«n song ngá»¯ (Bilingual Guidance):**

**2.1. SQL:**

*   **Purpose:** To extract relevant data from the ChEMBL database.
*   **Má»¥c Ä‘Ã­ch:** TrÃ­ch xuáº¥t dá»¯ liá»‡u liÃªn quan tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u ChEMBL.

**2.2. Python:**

*   **Purpose:** To process the data, perform calculations, build models, and visualize results.
*   **Má»¥c Ä‘Ã­ch:** Xá»­ lÃ½ dá»¯ liá»‡u, thá»±c hiá»‡n tÃ­nh toÃ¡n, xÃ¢y dá»±ng mÃ´ hÃ¬nh vÃ  trá»±c quan hÃ³a káº¿t quáº£.

**3. Code SQL vÃ  Python máº«u (Sample SQL and Python Code):**

**3.1. SQL (with error handling):**

```sql
-- Extract data for Topic_CheMBL_35_39 (limited to 100 records)
-- TrÃ­ch xuáº¥t dá»¯ liá»‡u cho Topic_CheMBL_35_39 (giá»›i háº¡n 100 báº£n ghi)

SELECT
    act.molregno,
    act.standard_type,
    act.standard_value,
    act.standard_units,
    md.chembl_id,
    cs.canonical_smiles
FROM
    activities act
JOIN
    molecule_dictionary md ON act.molregno = md.molregno
JOIN
    compound_structures cs ON md.molregno = cs.molregno
WHERE
    act.standard_type IN ('IC50', 'Ki', 'EC50')  -- Example activity types
    AND act.standard_units = 'nM' -- Example units
    AND act.standard_value IS NOT NULL
    AND cs.canonical_smiles IS NOT NULL
    -- Handle the numeric check safely:
    AND act.standard_value::text ~ '^[0-9\.]+$'  -- Check if it's numeric
LIMIT 100;
```

**Explanation:**

*   The `::text` cast is used to convert `standard_value` to text before applying the regular expression.
*   We limit the results to 100 records using `LIMIT 100`.

**3.2. Python (with scikit-learn version check):**

```python
import pandas as pd
import numpy as np
from rdkit import Chem
from rdkit.Chem import AllChem
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error
import sklearn
import os

print(f"Scikit-learn version: {sklearn.__version__}")

# Define paths (following AIMLOps Template)
base_path = "../data"  # Adjust if needed
csv_file = os.path.join(base_path, "chembl_35_data.csv") # Replace with your actual filename

# Load data
try:
    data = pd.read_csv(csv_file)
    print("Data loaded successfully.")
except FileNotFoundError:
    print(f"Error: File not found at {csv_file}")
    exit()

# Data Cleaning and Preprocessing
data = data.dropna(subset=['canonical_smiles', 'standard_value']) # Drop rows with missing SMILES or activity values
data = data[data['standard_value'].astype(str).str.match(r'^[0-9\.]+$')] #Keep numeric values only
data['standard_value'] = pd.to_numeric(data['standard_value']) # Transform to numeric

# Function to convert SMILES to Morgan Fingerprints
def smiles_to_morgan(smiles, radius=2, n_bits=2048):
    try:
        mol = Chem.MolFromSmiles(smiles)
        if mol:
            fp = AllChem.GetMorganFingerprintAsBitVect(mol, radius, nBits=n_bits)
            return np.array(list(fp.ToBitString()), dtype=int)
        else:
            return None
    except:
        return None

# Apply the function to create fingerprints
data['morgan_fp'] = data['canonical_smiles'].apply(smiles_to_morgan)
data = data.dropna(subset=['morgan_fp'])  # Remove rows where fingerprint generation failed
data = data[data['morgan_fp'].map(len) > 0]

# Prepare data for machine learning
X = np.stack(data['morgan_fp'].values)
y = data['standard_value'].values

# Split data into training and testing sets
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Train a RandomForestRegressor model
model = RandomForestRegressor(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# Make predictions
y_pred = model.predict(X_test)

# Calculate Mean Squared Error
if sklearn.__version__ < '0.22':
    mse = mean_squared_error(y_test, y_pred)
else:
    mse = mean_squared_error(y_test, y_pred, squared=False)  # Use squared=False for newer versions

print(f"Mean Squared Error: {mse}")
```

**Explanation:**

*   **Error Handling:** Includes `try...except` blocks for file loading and SMILES conversion.
*   **Scikit-learn Version Check:**  Checks the scikit-learn version and uses the appropriate `mean_squared_error` call.
*   **Data Preprocessing:**  Handles missing data and converts SMILES to Morgan fingerprints.
*   **Model Training:**  Trains a Random Forest Regressor.
*   **Evaluation:**  Calculates and prints the Mean Squared Error.

**4. VÃ­ dá»¥ code SQL vÃ  Python máº«u (Sample SQL and Python Code Examples):**

Here are 5 examples of SQL and Python code snippets that you can adapt for your project.

**Example 1:  Extracting compounds with specific properties**

*   **SQL:**
    ```sql
    SELECT md.chembl_id, cs.canonical_smiles, act.standard_value
    FROM molecule_dictionary md
    JOIN compound_structures cs ON md.molregno = cs.molregno
    JOIN activities act ON md.molregno = act.molregno
    WHERE md.mw_freebase < 300 -- Molecular weight less than 300
    AND act.standard_type = 'IC50'
    LIMIT 10;
    ```
*   **Python:** (Reading from a CSV file generated from the SQL query above)
    ```python
    import pandas as pd
    data = pd.read_csv('../data/example1.csv') # Update with the correct path
    print(data.head())
    ```

**Example 2: Calculating LogP using RDKit**

*   **SQL:** (Extract SMILES strings)
    ```sql
    SELECT md.chembl_id, cs.canonical_smiles
    FROM molecule_dictionary md
    JOIN compound_structures cs ON md.molregno = cs.molregno
    LIMIT 10;
    ```

*   **Python:**
    ```python
    import pandas as pd
    from rdkit import Chem
    from rdkit.Chem import Descriptors

    data = pd.read_csv('../data/example2.csv') # Update with the correct path

    def calculate_logp(smiles):
        mol = Chem.MolFromSmiles(smiles)
        if mol:
            return Descriptors.MolLogP(mol)
        else:
            return None

    data['logp'] = data['canonical_smiles'].apply(calculate_logp)
    print(data.head())
    ```

**Example 3:  Filtering by activity value range**

*   **SQL:**
    ```sql
    SELECT md.chembl_id, cs.canonical_smiles, act.standard_value
    FROM molecule_dictionary md
    JOIN compound_structures cs ON md.molregno = cs.molregno
    JOIN activities act ON md.molregno = act.molregno
    WHERE act.standard_type = 'IC50'
    AND act.standard_value BETWEEN 10 AND 100  -- IC50 between 10 and 100 nM
    LIMIT 10;
    ```

*   **Python:** (Analyzing the extracted data)
    ```python
    import pandas as pd
    import matplotlib.pyplot as plt

    data = pd.read_csv('../data/example3.csv') # Update with the correct path
    plt.hist(data['standard_value'])
    plt.xlabel('IC50 (nM)')
    plt.ylabel('Frequency')
    plt.title('IC50 Distribution')
    plt.show()
    ```

**Example 4:  Generating Morgan fingerprints and visualizing them**

*   **SQL:** (Extract SMILES)
        ```sql
    SELECT md.chembl_id, cs.canonical_smiles
    FROM molecule_dictionary md
    JOIN compound_structures cs ON md.molregno = cs.molregno
    LIMIT 10;
    ```
*   **Python:**
    ```python
    import pandas as pd
    from rdkit import Chem
    from rdkit.Chem import AllChem
    import matplotlib.pyplot as plt

    data = pd.read_csv('../data/example4.csv') # Update with the correct path

    def generate_morgan_fp(smiles):
        mol = Chem.MolFromSmiles(smiles)
        if mol:
            fp = AllChem.GetMorganFingerprint(mol, 2) # Radius 2
            return fp
        else:
            return None

    data['morgan_fp'] = data['canonical_smiles'].apply(generate_morgan_fp)
    print(data.head())
    ```

**Example 5: Basic Activity Prediction with a Simple Model**

*   **SQL:**
    ```sql
    SELECT md.chembl_id, cs.canonical_smiles, act.standard_value
    FROM molecule_dictionary md
    JOIN compound_structures cs ON md.molregno = cs.molregno
    JOIN activities act ON md.molregno = act.molregno
    WHERE act.standard_type = 'IC50'
    AND act.standard_units = 'nM'
    LIMIT 100;
    ```
*   **Python:** (Simple Activity Prediction)
    ```python
    import pandas as pd
    from rdkit import Chem
    from rdkit.Chem import AllChem
    from sklearn.model_selection import train_test_split
    from sklearn.linear_model import LinearRegression
    from sklearn.metrics import mean_squared_error
    import numpy as np

    # Load data
    data = pd.read_csv('../data/example5.csv') # Update with the correct path
    data.dropna(inplace=True)

    # RDKit: Generate Morgan Fingerprints
    def generate_fingerprint(smiles):
        mol = Chem.MolFromSmiles(smiles)
        if mol is not None:
            fp = AllChem.GetMorganFingerprintAsBitVect(mol, radius=2, nBits=2048)
            return np.array(list(fp))
        else:
            return None

    data['fingerprint'] = data['canonical_smiles'].apply(generate_fingerprint)
    data.dropna(subset=['fingerprint'], inplace=True)

    # Prepare data
    X = np.stack(data['fingerprint'].values)
    y = data['standard_value'].values

    # Split data
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    # Model training
    model = LinearRegression()
    model.fit(X_train, y_train)

    # Make predictions
    y_pred = model.predict(X_test)

    # Evaluate
    mse = mean_squared_error(y_test, y_pred)
    print(f'Mean Squared Error: {mse}')
    ```

**Important Considerations:**

*   **Database Connection:** You'll need to establish a connection to your PostgreSQL database using a Python library like `psycopg2`.
*   **Data Scaling/Normalization:** Consider scaling or normalizing your activity values (e.g., converting IC50 to pIC50) to improve model performance.
*   **Feature Selection:** Explore different molecular descriptors and feature selection techniques to optimize your models.
*   **Model Validation:** Use appropriate validation techniques (e.g., cross-validation) to ensure the robustness of your models.
*   **Logging:** Implement logging to track the progress of your analysis and debug any issues.
*   **AIMLOps:** Integrate your code into the AIMLOps framework for reproducibility, version control, and automated deployment.

HÃ£y cho tÃ´i biáº¿t náº¿u báº¡n cÃ³ báº¥t ká»³ cÃ¢u há»i cá»¥ thá»ƒ nÃ o hoáº·c muá»‘n tÃ´i Ä‘i sÃ¢u hÆ¡n vÃ o má»™t khÃ­a cáº¡nh cá»¥ thá»ƒ cá»§a dá»± Ã¡n. ChÃºc báº¡n thÃ nh cÃ´ng!
